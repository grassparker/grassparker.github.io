<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weirdest Word Search</title>
    <style>
        /* UPDATED CELL SIZE FOR RESPONSIVENESS */
        :root {
            --cell-size: 4vw; /* Default size based on 4% of viewport width */
            --highlight-color: #fef08a;
            --found-color: #86efac;
            --award-color: #34d399;
            --primary-color: #6366f1;
            --danger-color: #ef4444;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #684C46;
            color: #959595;
            margin: 0;
            padding: 20px 10px; /* Reduced side padding slightly */
            user-select: none;
        }

        /*Header*/
        .header-stats {
            display: flex;
            gap: 15px; /* Reduced gap */
            margin-bottom: 20px;
            background: #959595;
            color: #684C46;
            padding: 10px 15px; /* Reduced padding */
            border-radius: 0;
            box-shadow: none;
            font-size: 1rem; /* Adjusted font size */
            font-weight: bold;
            flex-wrap: wrap; /* Allows stats to wrap on small screens */
            justify-content: center;
        }

        .stat-box {
            text-align: center;
        }
        .stat-box span { color: var(--found-color); }
        #timer.low-time { color: var(--danger-color); animation: pulse 1s infinite; }
        #awards-count { color: var(--award-color); }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /*Hints*/
        .hint-display {
            font-size: 1rem;
            font-style: italic;
            color: #9ca3af;
            margin-bottom: 15px;
            min-height: 20px;
            text-align: center;
        }

        .hint-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        #revealed-hint-display {
            color: #fef08a;
            font-weight: bold;
            font-size: 1.1rem;
            text-align: center;
        }

        /*Grid*/
        #grid {
            display: grid;
            border: 2px solid #4b5563;
            background: #4b5563;
            gap: 1px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            max-width: 95vw; /* Ensure grid doesn't exceed screen width */
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background-color: #1f2937;
            color: #e5e7eb;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: calc(var(--cell-size) * 0.5); /* Font size scales with cell size */
            cursor: pointer;
            text-transform: uppercase;
        }

        .cell.selected { background-color: var(--highlight-color); color: black; }
        .cell.found-clue { background-color: var(--found-color); color: black; }
        .cell.found-award { background-color: var(--award-color); color: black; }

        /* Modals and Buttons (Slightly responsive) */
        .modal-content {
            padding: 20px;
            max-width: 90vw;
        }

        button {
            padding: 10px 15px;
            font-size: 1rem;
        }

        /* MEDIA QUERY FOR SMALL SCREENS (Phones) */
        @media (max-width: 600px) {
            :root {
                --cell-size: 6vw; /* Increase cell size for better touch/readability on small screens */
            }
            .header-stats {
                font-size: 0.9rem;
                padding: 8px 10px;
            }
            h1 {
                font-size: 1.5rem;
            }
        }
        /* MEDIA QUERY FOR EXTREMELY SMALL SCREENS */
        @media (max-width: 400px) {
            :root {
                --cell-size: 7vw;
            }
        }

        /* --- END OF STYLE UPDATES --- */

        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background: white;
            color: #1f2937;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .modal-content h2 { margin-top: 0; color: var(--primary-color); }
        
        input[type="text"] {
            width: 80%;
            padding: 10px;
            margin: 15px 0;
            font-size: 1rem;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            text-align: center;
            text-transform: uppercase;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.2s;
        }
        button:hover { opacity: 0.9; }
        button:disabled { background-color: #4b5563; cursor: not-allowed; opacity: 0.7; }
        
        .hidden { display: none !important; }
        .visible { display: flex !important; }

    </style>
</head>

<body>

    <h1 id="level-title">Level 1</h1>

    <div class="header-stats">
        <div class="stat-box">Time: <span id="timer">60</span>s</div>
        <div class="stat-box">Clues Found: <span id="found-count">0</span>/<span id="total-count">3</span></div>
        <div class="stat-box">Awards Found: <span id="awards-count">0</span></div>
    </div>
    
    <div id="theme-hint-display" class="hint-display"></div>
    
    <div class="hint-controls">
        <button id="hint-button-reveal" onclick="revealNextWordHint()">Reveal a Clue (Cost: 1 Award)</button>
        <div id="revealed-hint-display"></div>
    </div>

    <div id="grid"></div>

    <div id="question-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Level Complete!</h2>
            <p>You found the clues. Now, answer this:</p>
            <p id="riddle-text" style="font-weight:bold; font-size:1.1rem;">[Question goes here]</p>
            <input type="text" id="answer-input" placeholder="TYPE ANSWER HERE" autocomplete="off">
            <br>
            <button onclick="checkAnswer()">Submit Answer</button>
            <p id="error-msg" style="color: red; display: none;">Incorrect, try again!</p>
        </div>
    </div>

    <div id="game-over-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color: #ef4444;">Ugh! So close...</h2>
            <p>You didn't find the clues in time.</p>
            <button onclick="restartLevel()">Try Again</button>
        </div>
    </div>

    <div id="victory-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color: #10b981;">Woohooo!!!!</h2>
            <p>You have completed all levels.</p>
            <button onclick="location.reload()">Play Again</button>
        </div>
    </div>

    <script>
        /* ------------------------------------------
           CONFIGURATION of puzzles
           ------------------------------------------ */
        
        const levels = [
            {
                // Level 1: Kings and Queens
                gridSize: 10,
                timeLimit: 90,
                wordsToFind: ["KING", "QUEEN", "PRINCE", "PRINCESS", "KNIGHT"],
                awardsToFind: ["THRONE", "CROWN", "ROBE", "DRESS", "SWORD"],
                themeHint: "The royal family. (Awards: things associated with the royal members.)", 
                question: "How many wifes does Henry(VIII) had?",
                validAnswers: ["6", "SIX"]
            },
            {
                // Level 2: Towns
                gridSize: 11,
                timeLimit: 120,
                wordsToFind: ["CHURCH", "TOWNSQUARE", "MARKETPLACE", "TOWNHALL", "WELL", "STABLES", "BUTCHER"], 
                awardsToFind: ["FARMERS", "MERCHANTS", "NOBLES", "MONKS", "BLACKSMITHS"], 
                themeHint: "Medieval town features. (Awards: people in the town.)", 
                question: "What do you call a large human settlement?",
                validAnswers: ["CITIES", "CITY"]
            },
            {
                // Level 3: Medieval weapons
                gridSize: 12,
                timeLimit: 150,
                wordsToFind: ["SWORD", "BOW", "ARROW", "DAGGER", "MACE", "AXE", "SPEAR"],
                awardsToFind: ["SIEGE", "DEFENCE", "RANGED", "MELEE", "ARMOR"], 
                themeHint: "Medieval weaponry. (Awards: their role in combat.)", 
                question: "Which weapon is known as the 'king of weapons'?",
                validAnswers: ["SPEAR", "SPEARS", "THE SPEAR"]
            },
            {
                // Level 4: Architectural Wonders
                gridSize: 13,
                timeLimit: 180,
                wordsToFind: ["GOTHIC", "ROMANESQUE", "CATHEDRAL", "CASTLE", "FORTRESS", "BRIDGE", "TOWER"],
                awardsToFind: ["ARCH", "BUTTRESS", "DOME", "VAULT", "SPIRE"], 
                themeHint: "Architectural wonders (Awards: their features.)", 
                question: "Where is the castle mentioned in Dracula by Bram Stoker located?",
                validAnswers: ["TRANSYLVANIA", "ROMANIA"]
            },
            {
                // Level 5: Medieval food
                gridSize: 14,
                timeLimit: 200,
                wordsToFind: ["BREAD", "MEAD", "CHEESE", "HONEY", "PORRIDGE", "ALE", "MUTTON"],
                awardsToFind: ["POTAGE", "PIE", "PASTRY", "STEW", "HERBS"],
                themeHint: "Medieval food (Awards: specific dishes or ingredients.)",
                question: "What was a common sweetener in medieval European cooking?",
                validAnswers: ["HONEY"]
            },
            {
                // Level 6: Law & Governance
                gridSize: 15,
                timeLimit: 210,
                wordsToFind: ["KING", "CHARTER", "TRIBUNAL", "TAXATION", "DECREE", "SHERIFF", "COUNCIL"],
                awardsToFind: ["EDICT", "LOYALTY", "VASSALAGE", "CUSTOMS", "TENURE"],
                themeHint: "Law & governance (Awards: related legal terms.)",
                question: "What was the famous medieval document that limited the English kingâ€™s power?",
                validAnswers: ["MAGNA CARTA", "THE MAGNA CARTA"]
            },
            {
                // Level 7: Knighthood
                gridSize: 16,
                timeLimit: 240,
                wordsToFind: ["KNIGHT", "SQUIRE", "CHIVALRY", "JOUST", "ARMOR", "LANCE", "HORSE"],
                awardsToFind: ["HERALDRY", "TITHE", "VOW", "SWORD", "SHIELD"],
                themeHint: "Knighthood (Awards: symbols and practices of knights.)",
                question: "What code of conduct guided knights in medieval Europe?",
                validAnswers: ["CHIVALRY"]
            }
            
        ];

        /* ------------------------------------------
           Gme logic
           ------------------------------------------ */

        let currentLevelIdx = 0;
        let currentLevelData = null;
        
        //State
        let gridArr = [];
        let foundWords = new Set();
        let foundAwards = new Set();
        let isSelecting = false;
        let startCell = null;
        let currentSelection = [];
        let timeLeft = 0;
        let timerInterval = null;
        let awardsCount = 0;

        //DOM Elements
        const gridEl = document.getElementById('grid');
        const timerEl = document.getElementById('timer');
        const foundCountEl = document.getElementById('found-count');
        const totalCountEl = document.getElementById('total-count');
        const levelTitle = document.getElementById('level-title');
        
        //Hint/Award Elements
        const awardsCountEl = document.getElementById('awards-count');
        const themeHintDisplay = document.getElementById('theme-hint-display');
        const hintButtonReveal = document.getElementById('hint-button-reveal');
        const revealedHintDisplay = document.getElementById('revealed-hint-display'); 

        //Modals
        const questionModal = document.getElementById('question-modal');
        const gameOverModal = document.getElementById('game-over-modal');
        const victoryModal = document.getElementById('victory-modal');
        const riddleText = document.getElementById('riddle-text');
        const answerInput = document.getElementById('answer-input');
        const errorMsg = document.getElementById('error-msg');

        const directions = [[1, 0], [0, 1], [1, 1], [1, -1]];
        
        //Awards
        function increaseAwards(amount) {
            awardsCount += amount;
            awardsCountEl.innerText = awardsCount;
        }

        function loadLevel(index) {
            if (index >= levels.length) {
                // Final victory display with total awards
                const victoryContent = victoryModal.querySelector('.modal-content');
                victoryContent.innerHTML = `
                    <h2 style="color: #10b981;">Woohooo!!!!</h2>
                    <p>You have completed all levels.</p>
                    <p style="font-size: 1.5rem; font-weight: bold;">Total Awards Earned: ${awardsCount}</p>
                    <button onclick="location.reload()">Play Again</button>
                `;
                victoryModal.classList.add('visible');
                return;
            }

            currentLevelIdx = index;
            currentLevelData = levels[index];
            
            //Reset Level State
            foundWords.clear();
            foundAwards.clear();

            //Reset UI
            levelTitle.innerText = `Level ${index + 1}`;
            updateStats();
            
            //Reset Hints/Awards UI
            themeHintDisplay.innerText = currentLevelData.themeHint; 
            revealedHintDisplay.innerText = '';
            hintButtonReveal.disabled = false;

            //Hide Modals
            questionModal.classList.remove('visible');
            gameOverModal.classList.remove('visible');
            errorMsg.style.display = 'none';
            answerInput.value = '';

            //Generate Grid (combining primary words and awards)
            const allWords = [...currentLevelData.wordsToFind, ...currentLevelData.awardsToFind];
            generateGrid(currentLevelData.gridSize, allWords);
            
            //Start Timer
            startTimer(currentLevelData.timeLimit);
        }

        /* ------------------------------------------
           Timer
           ------------------------------------------ */

        function startTimer(seconds) {
            clearInterval(timerInterval);
            timeLeft = seconds;
            timerEl.innerText = timeLeft;
            timerEl.classList.remove('low-time');
            
            timerInterval = setInterval(() => {
                timeLeft--;
                timerEl.innerText = timeLeft;
                
                if (timeLeft <= 10) timerEl.classList.add('low-time');

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    gameOverModal.classList.add('visible');
                }
            }, 1000);
        }

        /* ------------------------------------------
           Grid generation
           ------------------------------------------ */

        function generateGrid(size, words) {
            gridEl.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            gridEl.innerHTML = '';
            gridArr = Array(size).fill(null).map(() => Array(size).fill(''));

            words.forEach(word => placeWord(word, size));
            
            const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    if (gridArr[r][c] === '') {
                        gridArr[r][c] = alphabet[Math.floor(Math.random() * alphabet.length)];
                    }
                    createCell(r, c, gridArr[r][c]);
                }
            }
            
            document.addEventListener('mouseup', handleMouseUp);
        }

        function createCell(r, c, char) {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.dataset.row = r;
            cell.dataset.col = c;
            cell.innerText = char;
            
            //Laptop
            cell.addEventListener('mousedown', handleMouseDown);
            cell.addEventListener('mouseenter', handleMouseEnter);
            cell.addEventListener('mouseup', handleMouseUp);

            //Mobile
            cell.addEventListener('touchstart', handleMouseDown, { passive: false });
            cell.addEventListener('touchmove', (e) => {
                e.preventDefault();  // Stops page scrolling while dragging
                const touch = e.touches[0];
                const el = document.elementFromPoint(touch.clientX, touch.clientY);
                if (el && el.classList.contains('cell')) {
                    handleMouseEnter({ target: el });
                }
            }, { passive: false });
            document.addEventListener('touchend', handleMouseUp);
            
            gridEl.appendChild(cell);
        }

        function placeWord(word, size) {
            let placed = false;
            let attempts = 0;
            while (!placed && attempts < 100) {
                const dir = directions[Math.floor(Math.random() * directions.length)];
                const row = Math.floor(Math.random() * size);
                const col = Math.floor(Math.random() * size);

                if (canPlace(word, row, col, dir, size)) {
                    for (let i = 0; i < word.length; i++) {
                        gridArr[row + i * dir[1]][col + i * dir[0]] = word[i];
                    }
                    placed = true;
                }
                attempts++;
            }
        }

        function canPlace(word, row, col, dir, size) {
            for (let i = 0; i < word.length; i++) {
                const r = row + i * dir[1];
                const c = col + i * dir[0];
                if (r < 0 || r >= size || c < 0 || c >= size) return false;
                if (gridArr[r][c] !== '' && gridArr[r][c] !== word[i]) return false;
            }
            return true;
        }

        /* ------------------------------------------
           Interaction logic
           ------------------------------------------ */

        function handleMouseDown(e) {
            isSelecting = true;
            startCell = e.target;
            updateSelection(e.target);
        }

        function handleMouseEnter(e) {
            if (isSelecting) updateSelection(e.target);
        }

        function handleMouseUp() {
            if (isSelecting) {
                isSelecting = false;
                checkWord();
                clearSelection();
            }
        }

        function updateSelection(endCell) {
            document.querySelectorAll('.cell.selected').forEach(el => el.classList.remove('selected'));
            const startR = parseInt(startCell.dataset.row);
            const startC = parseInt(startCell.dataset.col);
            const endR = parseInt(endCell.dataset.row);
            const endC = parseInt(endCell.dataset.col);
            
            const diffR = endR - startR;
            const diffC = endC - startC;

            if (diffR === 0 || diffC === 0 || Math.abs(diffR) === Math.abs(diffC)) {
                const len = Math.max(Math.abs(diffR), Math.abs(diffC));
                const stepR = diffR === 0 ? 0 : diffR / len;
                const stepC = diffC === 0 ? 0 : diffC / len;

                currentSelection = [];
                for (let i = 0; i <= len; i++) {
                    const r = startR + i * stepR;
                    const c = startC + i * stepC;
                    const cell = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
                    if (cell) {
                        cell.classList.add('selected');
                        currentSelection.push(cell);
                    }
                }
            }
        }

        /* ------------------------------------------
           Word checking logic (Differentiated)
           ------------------------------------------ */
        function checkWord() {
            const selectedWord = currentSelection.map(cell => cell.innerText).join('');
            const reversed = selectedWord.split('').reverse().join('');
            const primaryWords = currentLevelData.wordsToFind;
            const awardWords = currentLevelData.awardsToFind;

            let found = false;
            let word = '';
            let type = ''; // 'clue' or 'award'

            // Check if it's a primary clue (for level completion)
            if ((primaryWords.includes(selectedWord) && !foundWords.has(selectedWord)) || 
                (primaryWords.includes(reversed) && !foundWords.has(reversed))) {
                
                word = primaryWords.includes(selectedWord) ? selectedWord : reversed;
                foundWords.add(word);
                type = 'clue';
                found = true;
            } 
            // Check if it's a bonus award (for points)
            else if ((awardWords.includes(selectedWord) && !foundAwards.has(selectedWord)) || 
                     (awardWords.includes(reversed) && !foundAwards.has(reversed))) {
                
                word = awardWords.includes(selectedWord) ? selectedWord : reversed;
                foundAwards.add(word);
                increaseAwards(1); // Award 1 point for finding a bonus word
                type = 'award';
                found = true;
            }

            if (found) {
                currentSelection.forEach(cell => {
                    cell.classList.add(type === 'clue' ? 'found-clue' : 'found-award');
                    cell.classList.remove('selected');
                });

                updateStats();
                checkLevelCompletion();
            }
        }

        function clearSelection() {
            document.querySelectorAll('.cell.selected').forEach(el => el.classList.remove('selected'));
            currentSelection = [];
            startCell = null;
        }

        /* ------------------------------------------
           Hints (Dynamic Word Reveal)
           ------------------------------------------ */
        function revealNextWordHint() {
            if (awardsCount > 0) { 
                const unfoundWords = currentLevelData.wordsToFind.filter(word => !foundWords.has(word));
                
                if (unfoundWords.length > 0) {
                    const wordToReveal = unfoundWords[0];
                    increaseAwards(-1); // Cost 1 Award Point
                    revealedHintDisplay.innerText = `Revealed Clue: ${wordToReveal}`;
                } else {
                    revealedHintDisplay.innerText = "All clues have been found!";
                    hintButtonReveal.disabled = true;
                }
            } else {
                // Not enough awards to use the hint
                revealedHintDisplay.innerText = "Need 1 Award to use this hint!";
            }
        }

        function updateStats() {
            foundCountEl.innerText = foundWords.size;
            totalCountEl.innerText = currentLevelData.wordsToFind.length;
            awardsCountEl.innerText = awardsCount;
        }

        function checkLevelCompletion() {
            if (foundWords.size === currentLevelData.wordsToFind.length) {
                //Pause timer
                clearInterval(timerInterval);
                //Show question
                setTimeout(() => {
                    riddleText.innerText = currentLevelData.question;
                    questionModal.classList.add('visible');
                    answerInput.focus();
                }, 500);
            }
        }

        /* ------------------------------------------
           Progression logic
           ------------------------------------------ */

        function checkAnswer() {
            const userAns = answerInput.value.toUpperCase().trim();
            if (currentLevelData.validAnswers.includes(userAns)) {
                // Correct!
                loadLevel(currentLevelIdx + 1);
            } else {
                // Incorrect
                errorMsg.style.display = 'block';
                answerInput.classList.add('shake');
                setTimeout(() => answerInput.classList.remove('shake'), 500);
            }
        }

        function restartLevel() {
            loadLevel(currentLevelIdx);
        }

        //Enter to submit
        answerInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") checkAnswer();
        });

        //LOS GEHT'S
        loadLevel(0);

    </script>
</body>
</html>